<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FACTURA</title>
    <link rel="icon" href="https://github.com/rimedhn/controlfarma/blob/main/Logo%20Contol%20Farma.jpeg?raw=true" type="image/x-icon">
    <style type="text/css">
      #letter-size {
        width: 5.5in;
        margin: 0in;
        padding: 20px;
        font-family: Arial, sans-serif;
        margin-left: 0.2in;
        margin-right: 0.2in;
        margin-top: 0.5in;
        margin-bottom: 0.5in;
      }
      .label {
        text-align: center;
        font-size: 18px;
        margin-bottom: 10px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        word-break: break-word;
        white-space: normal;
        overflow-wrap: break-word;
      }
      .sin-bordes {
        border-collapse: collapse;
        border: 0px;
      }
      table,
      th,
      td {
        border: 1px solid black;
        padding: 8px;
        word-break: break-word;
        white-space: normal;
        overflow-wrap: break-word;
      }
      #detailhead .line1 {
        text-align: left;
        width: 50%;
      }
      .detail1 {
        text-align: right;
        width: 50%;
      }
      .Fact {
        text-align: left;
      }
      .listitem {
        font-size: 16px;
        text-align: left;
      }
      #listitemhead {
        font-size: 5px;
        text-align: center;
      }
      .descriptions {
        text-align: left;
      }
      .Price,
      .Desc,
      .Isv,
      .Amount {
        text-align: right;
      }
      #letter-size h2 {
        font-size: 22px;
        text-align: center;
        margin-bottom: 10px;
      }
      #letter-size .informasi {
        text-align: left;
        font-size: 16px;
        margin-bottom: 5px;
      }
      #letter-size .bawah {
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
      }
      .mi-imagen {
        width: 100px;
        height: 100px;
        padding: auto;
        align: center;
        vertical-align: center;
      }
    </style>
  </head>
  <body>
    <div class="label">    
      <table style="width: 100%; border-collapse: collapse;
        border: none;" class="sin-bordes">
        <tr>
          <th colspan="3" style="width: 10%">
            <img src="https://github.com/rimedhn/controlfarma/blob/main/Logo%20Contol%20Farma.jpeg?raw=true" alt="Mi imagen" class="mi-imagen" />
          </th>
          <th colspan="9" style="width: 90%; text-align: left">
            <b style="font-size: 30px" id="empresa"></b><br />
            <b>RTN: <span id="rtn"></span></b><br />
            <b><span id="direccion"></span></b><br />
            <b>Telefono: <span id="telefono"></span></b><br />
            <b>Email: <span id="email"></span></b>
            <b id="razon"></b>
          </th>
        </tr>
      </table>
      <table style="width: 100%">
        <tr>
          <th colspan="12">
            <b><h2 id="tipodoc"></h2></b>
          </th>
        </tr>
        <tr>
          <th colspan="6" style="width: 50%; white-space: nowrap">
            Datos cliente
          </th>
          <th colspan="6" style="width: 50%; white-space: nowrap">
            Datos factura
          </th>
        </tr>
        <tr>
          <td colspan="6" style="width: 50%; white-space: nowrap; word-break: break-word; white-space: normal; overflow-wrap: break-word;">
            <div style="text-align: left">
              <b>Cliente: <span id="cliente"></span></b><br />
              <b>RTN: <span id="rtncliente"></span></b><br />
              <b>Telefono: <span id="telefonocliente"></span></b><br />
              <b>Direccion: <span id="direccioncliente"></span></b><br />
              <b>Vendedor: <span id="vendedor"></span></b><br />
            </div>
          </td>
          <td colspan="6" style="width: 50%;  white-space: nowrap; word-break: break-word; white-space: normal; overflow-wrap: break-word;">
            <div style="text-align: left">
              <b>Factura: <span id="factura"></span></b><br />
              <b>Fecha: <span id="date"></span></b><br />
              <b>CAI: <span id="cai"></span></b><br />
              <b>Rango autorizado: <span id="rango"></span></b><br />
              <b>Fecha limite de emision: <span id="limite"></span></b><br />
              <b>Cajero: <span id="cajero"></span></b><br />
            </div>
          </td>
        </tr>
      </table>
      <table style="width: 100%">
        <tr>
          <td style="text-align: center; class="detalleproducts" colspan="6">Detalle</td>
        </tr>
        <tr>
          <td  style="text-align: center; width: 10%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Cant
            </h2>
          </td>
          <td  style="text-align: left; width: 40%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Descripcion
            </h2>
          </td>
          <td  style="text-align: right; width: 11%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Precio
            </h2>
          </td>
          <td  style="text-align: right; width: 14%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Subt.
            </h2>
          </td>
          <td  style="text-align: right; width: 11%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Isv
            </h2>
          </td>
          <td  style="text-align: right; width: 14%">
            <h2 style="font-size: 4mm; text-align: Center; line-height: 0.1">
              Monto
            </h2>
          </td>
        </tr>
        <tbody id="productList"></tbody>
        <tr>
          <td colspan="2" style="border-top: 1px solid black; text-align: left; vertical-align: text-top;">
            <span id="motor"></span><br />
            <span id="chasis"></span><br />
            <span id="color"></span><br />
            <span id="aÃ±o"></span><br />
            <span id="marca"></span>&nbsp;&nbsp;<span id="modelo"></span>&nbsp;&nbsp;<span id="combustible"></span>
            <div align="left">
              --------------------------------------------------------------------------------------------------
            </div>
            Observaciones: <span id="observacion"></span>
            <div align="left">
              --------------------------------------------------------------------------------------------------
            </div>
            <b>Datos del cliente exonerado</b><br />
            <span>Orden de compra exenta: <b id="ocexe"></b></span>&nbsp;&nbsp;
            <span>No. Registro exonerado: <b id="ocexo"></b></span>&nbsp;&nbsp;
            <span>No. Registro SAG: <b id="nosag"></b></span>
            <div align="left">
              --------------------------------------------------------------------------------------------------
            </div>
            <b>Condiciones de pago</b><br />
            <span>Formado de pago: <b id="formapago"></b></span>
            <span>Plazo en dias: <b id="plazo"></b></span><br />
            <span>Cantidad de pagos: <b id="pagos"></b></span>
            <span>Cuota por pago: <b>L <span id="cuota"></span></b></span>
          </td>
          <td colspan="2" style="white-space: nowrap; border-top: 1px solid black; text-align: right;">
            Subtotal:<br />
            Descuentos y rebajas:<br />
            Valor exento:<br />
            Valor exonerado:<br />
            Gravado con 15%:<br />
            Gravado con 18%:<br />
            Isv 15%:<br />
            Isv 18%:<br />
            <b>Total venta:</b>
          </td>
          <td colspan="2" style="white-space: nowrap; border-top: 1px solid black; text-align: right;">
            L<span id="subtotal"></span><br />
            L<span id="descuento"></span><br />
            L<span id="subtotalexe"></span><br />
            L<span id="subtotalexo"></span><br />
            L<span id="subtotalisv15"></span><br />
            L<span id="subtotalisv18"></span><br />
            L<span id="isv15"></span><br />
            L<span id="isv18"></span><br />
            <b>L<span id="total"></span></b>
          </td>
        </tr>
        <tr>
          <td colspan="12" style="white-space: nowrap; border-top: 1px solid black; text-align: center;">
            MONTO EN LETRAS: <span id="montoLetras"></span>
          </td>
        </tr>
        <tr>
          <td colspan="12" style="white-space: nowrap; border-top: 1px solid black; text-align: center;">
            <div>
              Gracias por su preferencia!!
              <br />
            </div>
          </td>
        </tr>
      </table>
      <table style="padding: 0; border: none; border-collapse: collapse">
        <tr style="border: none; border-collapse: collapse">
          <td colspan="3" style="text-align: left; vertical-align: top; border: none; border-collapse: collapse;">
            <b>Original: cliente, Copia: emisor</b>
            <br /><span>www.rmposhn.com</span><br />
            <span>indime.hn@gmail.com</span>
            <span>(+504) 9359-3126</span>
          </td>
          <td colspan="3" style="white-space: nowrap; border: none; border-collapse: collapse">
            <div style="text-align: right">
              <img alt="Barcode Generator TEC-IT" id="barcode" />
            </div>
          </td>
        </tr>
      </table>
    </div>
    <script>
      function getQueryParam(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }
      function safeNum(val) {
        if (val === null || val === undefined || val === "") return "";
        var num = parseFloat(val.replace(",", "."));
        return isNaN(num) ? val : num.toFixed(2);
      }
      function fillData() {
        document.getElementById("empresa").textContent = getQueryParam("empresa");
        document.getElementById("razon").textContent = getQueryParam("razon");
        document.getElementById("rtn").textContent = getQueryParam("rtn");
        document.getElementById("direccion").textContent = getQueryParam("direccion");
        document.getElementById("telefono").textContent = getQueryParam("telefono");
        document.getElementById("email").textContent = getQueryParam("email");
        document.getElementById("tipodoc").textContent = getQueryParam("tipodoc");
        document.getElementById("cliente").textContent = getQueryParam("cliente");
        document.getElementById("rtncliente").textContent = getQueryParam("rtncliente");
        document.getElementById("telefonocliente").textContent = getQueryParam("telefonocliente");
        document.getElementById("direccioncliente").textContent = getQueryParam("direccioncliente");
        document.getElementById("vendedor").textContent = getQueryParam("vendedor");
        document.getElementById("factura").textContent = getQueryParam("factura");
        document.getElementById("date").textContent = getQueryParam("date");
        document.getElementById("cai").textContent = getQueryParam("cai");
        document.getElementById("rango").textContent = getQueryParam("rango");
        document.getElementById("limite").textContent = getQueryParam("limite");
        document.getElementById("cajero").textContent = getQueryParam("cajero");
        document.getElementById("ocexe").textContent = getQueryParam("ocexe");
        document.getElementById("ocexo").textContent = getQueryParam("ocexo");
        document.getElementById("nosag").textContent = getQueryParam("nosag");
        document.getElementById("formapago").textContent = getQueryParam("formapago");
        document.getElementById("plazo").textContent = getQueryParam("plazo");
        document.getElementById("pagos").textContent = getQueryParam("pagos");
        document.getElementById("cuota").textContent = getQueryParam("cuota");
        document.getElementById("motor").textContent = getQueryParam("motor");
        document.getElementById("chasis").textContent = getQueryParam("chasis");
        document.getElementById("color").textContent = getQueryParam("color");
        document.getElementById("aÃ±o").textContent = getQueryParam("aÃ±o");
        document.getElementById("marca").textContent = getQueryParam("marca");
        document.getElementById("modelo").textContent = getQueryParam("modelo");
        document.getElementById("combustible").textContent = getQueryParam("combustible");
        document.getElementById("observacion").textContent = getQueryParam("observacion");
        document.getElementById("subtotal").textContent = safeNum(getQueryParam("subtotal"));
        document.getElementById("descuento").textContent = safeNum(getQueryParam("descuento"));
        document.getElementById("subtotalexe").textContent = safeNum(getQueryParam("subtotalexe"));
        document.getElementById("subtotalexo").textContent = safeNum(getQueryParam("subtotalexo"));
        document.getElementById("subtotalisv15").textContent = safeNum(getQueryParam("subtotalisv15"));
        document.getElementById("subtotalisv18").textContent = safeNum(getQueryParam("subtotalisv18"));
        document.getElementById("isv15").textContent = safeNum(getQueryParam("isv15"));
        document.getElementById("isv18").textContent = safeNum(getQueryParam("isv18"));
        document.getElementById("total").textContent = safeNum(getQueryParam("total"));
        document.getElementById("barcode").src =
          "https://barcode.tec-it.com/barcode.ashx?data=" +
          getQueryParam("Folio_1");
        // Fill product list (handle decimals and undefined)
        var descriptions = getQueryParam("descriptions");
        descriptions = descriptions ? descriptions.split(",") : [];
        var quantitys = getQueryParam("quantitys");
        quantitys = quantitys ? quantitys.split(",") : [];
        var price = getQueryParam("price");
        price = price ? price.split(",") : [];
        var subtproducto = getQueryParam("subtproducto");
        subtproducto = subtproducto ? subtproducto.split(",") : [];
        var isvproducto = getQueryParam("isvproducto");
        isvproducto = isvproducto ? isvproducto.split(",") : [];
        var amounts = getQueryParam("amounts");
        amounts = amounts ? amounts.split(",") : [];
        var productList = document.getElementById("productList");
        var len = Math.max(
          descriptions.length,
          quantitys.length,
          price.length,
          subtproducto.length,
          isvproducto.length,
          amounts.length
        );
        for (var i = 0; i < len; i++) {
          var row = productList.insertRow();
          row.insertCell(0).textContent = safeNum(quantitys[i]);
          row.insertCell(1).textContent = descriptions[i] !== undefined ? descriptions[i] : "";
          row.insertCell(2).textContent = safeNum(price[i]);
          row.insertCell(3).textContent = safeNum(subtproducto[i]);
          row.insertCell(4).textContent = safeNum(isvproducto[i]);
          row.insertCell(5).textContent = safeNum(amounts[i]);
        }
        // Convert amount to words (with decimals)
        var totalParam = getQueryParam("total");
        var total = totalParam ? totalParam.replace(",", ".") : "0";
        document.getElementById("montoLetras").textContent = numeroALetras(total);
      }
      // Number to words in Spanish with decimals (lempiras and centavos)
      function numeroALetras(numero) {
        numero = typeof numero === "string" ? numero.replace(",", ".") : numero;
        var partes = numero.toString().split(".");
        var entero = parseInt(partes[0], 10);
        var decimales = partes[1] ? parseInt(partes[1].substring(0,2), 10) : 0;
        const unidades = [
          "",
          "UN",
          "DOS",
          "TRES",
          "CUATRO",
          "CINCO",
          "SEIS",
          "SIETE",
          "OCHO",
          "NUEVE",
          "DIEZ",
          "ONCE",
          "DOCE",
          "TRECE",
          "CATORCE",
          "QUINCE",
          "DIECISEIS",
          "DIECISIETE",
          "DIECIOCHO",
          "DIECINUEVE",
        ];
        const decenas = [
          "",
          "",
          "VEINTE",
          "TREINTA",
          "CUARENTA",
          "CINCUENTA",
          "SESENTA",
          "SETENTA",
          "OCHENTA",
          "NOVENTA",
        ];
        const centenas = [
          "",
          "CIENTO",
          "DOSCIENTOS",
          "TRESCIENTOS",
          "CUATROCIENTOS",
          "QUINIENTOS",
          "SEISCIENTOS",
          "SETECIENTOS",
          "OCHOCIENTOS",
          "NOVECIENTOS",
        ];
        function convertirGrupo(n) {
          let resultado = "";
          if (n === 100) {
            return "CIEN";
          }
          if (n >= 100) {
            resultado += centenas[Math.floor(n / 100)] + " ";
            n %= 100;
          }
          if (n >= 20) {
            resultado += decenas[Math.floor(n / 10)];
            if (n % 10 !== 0) {
              resultado += " Y " + unidades[n % 10];
            }
          } else if (n > 0) {
            resultado += unidades[n];
          }
          return resultado.trim();
        }
        function convertirMiles(n) {
          if (n === 0) return "";
          if (n === 1) return "MIL";
          return convertirGrupo(n) + " MIL";
        }
        function convertirMillones(n) {
          if (n === 0) return "";
          if (n === 1) return "UN MILLON";
          return convertirGrupo(n) + " MILLONES";
        }
        if (entero === 0) return "CERO LEMPIRAS";
        let resultado = "";
        let esNegativo = numero < 0;
        entero = Math.abs(entero);
        let millones = Math.floor(entero / 1000000);
        let miles = Math.floor((entero % 1000000) / 1000);
        let resto = entero % 1000;
        if (millones > 0) {
          resultado += convertirMillones(millones) + " ";
        }
        if (miles > 0) {
          resultado += convertirMiles(miles) + " ";
        }
        if (resto > 0 || resultado === "") {
          resultado += convertirGrupo(resto);
        }
        resultado = resultado.trim();
        if (esNegativo) {
          resultado = "MENOS " + resultado;
        }
        resultado += entero === 1 ? " LEMPIRA" : " LEMPIRAS";
        if (decimales > 0) {
          resultado += " CON " + decimales + (decimales === 1 ? " CENTAVO" : " CENTAVOS");
        }
        return resultado;
      }
      window.onload = function () {
        fillData();
        window.print();
      };
    </script>
  </body>
</html>
