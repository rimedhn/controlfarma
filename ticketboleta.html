<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>COTIZACIÓN</title>
    <link rel="icon" href="https://github.com/rimedhn/controlfarma/blob/main/Logo%20Contol%20Farma.jpeg?raw=true" type="image/x-icon">
    <style>
      #thermal-pos {
        box-shadow: 0 0 0mm #eee;
        margin: 0mm;
        max-width: 80mm;
        line-height: 4mm;
      }
      #thermal-pos h2 {
        font-size: 4mm;
        line-height: 13px;
      }
      #thermal-pos .label {
        text-align: center;
        font-size: 5mm;
        line-height: 1.3;
      }
      #thermal-pos .informasi {
        vertical-align: text-top;
        text-align: left;
        max-width: 45mm;
        word-wrap: break-word;
      }
      #thermal-pos .listitem {
        font-size: 4mm;
        height: 0mm;
        text-align: center;
      }
      #thermal-pos table {
        width: 100%;
        table-layout: fixed;
      }
      #thermal-pos .item {
        max-width: 80mm;
        font-size: 4.2mm;
        word-wrap: break-word;
        width: 100%;
      }
      #thermal-pos .amount {
        vertical-align: center;
        text-align: right;
        font-size: 4.2mm;
      }
      #thermal-pos .price {
        vertical-align: center;
        text-align: center;
        font-size: 4.2mm;
      }
      #thermal-pos .desc {
        vertical-align: center;
        text-align: center;
        font-size: 4.2mm;
      }
      #thermal-pos .qty {
        vertical-align: center;
        text-align: center;
        font-size: 4.2mm;
      }
      #thermal-pos .Isv {
        vertical-align: center;
        text-align: right;
        font-size: 4.2mm;
      }
      #thermal-pos .bawah {
        margin-top: 5mm;
        text-align: center;
        height: 90px;
        page-break-after: auto;
      }
      #thermal-pos .detail1 {
        margin-top: 5mm;
        text-align: right;
        page-break-after: auto;
      }
      #thermal-pos .detail {
        margin-top: 5mm;
        text-align: left;
        page-break-after: auto;
      }
      #all {
        font-family: Arial, sans-serif;
      }
      .mi-imagen {
        width: 200px;
        height: 100px;
      }
      #thermal-pos .listitem td {
        width: 20%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      #thermal-pos .descriptions {
        width: 100%;
        text-align: left;
        font-weight: bold;
        padding-top: 1px;
        padding-bottom: 1px;
      }
      /* Alineación específica para cada columna */
      #thermal-pos .listitem .qty {
        width: 15%;
        text-align: left;
      }
      #thermal-pos .listitem .Price,
      #thermal-pos .listitem .Desc,
      #thermal-pos .listitem .Isv {
        width: 20%;
        text-align: center;
      }
      #thermal-pos .listitem .Amount {
        width: 25%;
        text-align: right;
      }
    </style>
  </head>
  <body id="all">
    <div id="thermal-pos">
      <div class="label">
        <img src="https://github.com/rimedhn/controlfarma/blob/main/Logo_Control_Farma_Short-removebg.png?raw=true" alt="Mi imagen" class="mi-imagen" /><br />
        <span id="empresa"></span><br />
        <span id="razon"></span>
        <div class="label">
          <span>RTN: <span id="rtn"></span></span>
          <br />
        </div>
        <div class="label">
          <span><span id="direccion"></span></span>
          <br />
        </div>
        <div class="label">
          <span>Telefono: <span id="telefono"></span></span>
          <br />
        </div>
        <div class="label">
          <span id="email"></span>
          <br />
        </div>
      </div>
      <div align="center">--------------------------------------------------------</div>
      <div align="center" id="tipodoc"></div>
      <div align="center">--------------------------------------------------------</div>
      <table>
        <tr>
          <td class="informasi" style="width: 30%;">Folio:</td>
          <td class="informasi" style="width: 70%;" id="factura"></td>
        </tr>
        <tr>
          <td class="informasi" style="width: 30%;">Fecha:</td>
          <td class="informasi" style="width: 70%;" id="date"></td>
        </tr>        
      </table>
      <div align="center">--------------------------------------------------------</div>
      <div align="center">Datos del cliente</div>
      <div align="center">--------------------------------------------------------</div>
      <table>
        <tr>
          <td class="informasi" style="width: 30%;">Cliente:</td>
          <td class="informasi" style="width: 70%;" id="cliente"></td>
        </tr>
        <tr>
          <td class="informasi" style="width: 30%;">RTN:</td>
          <td class="informasi" style="width: 70%;" id="rtncliente"></td>
        </tr>
        <tr>
          <td class="informasi" style="width: 30%;">Direccion:</td>
          <td class="informasi" style="width: 70%;" id="direccioncliente"></td>
        </tr>
        <tr>
          <td class="informasi" style="width: 30%;">Telefono:</td>
          <td class="informasi" style="width: 70%;" id="telefonocliente"></td>
        </tr>
      </table>
      <div align="center">--------------------------------------------------------</div>
      <div align="center">Condiciones de pago</div>
      <div align="center">--------------------------------------------------------</div>
      <table>
        <tr>
          <td class="informasi">Forma de pago:</td>
          <td class="informasi" id="formapago"></td>
        </tr>
        <tr>
          <td class="informasi">Plazo en días:</td>
          <td class="informasi" id="plazo"></td>
        </tr>
        <tr>
          <td class="informasi">Cantida de pagos:</td>
          <td class="informasi" id="pagos"></td>
        </tr>
        <tr>
          <td class="informasi">Cuota por pago:</td>
          <td class="informasi">L<span id="cuota"></span></td>
        </tr>
      </table>
      <div align="center">--------------------------------------------------------</div>
      <div align="center">Detalle</div>
      <div align="center">--------------------------------------------------------</div>
      <table>
        <tr class="listitem">
          <td><h2>Cant</h2></td>
          <td><h2>Precio</h2></td>
          <td><h2>Desc.</h2></td>
          <td><h2>Isv</h2></td>
          <td><h2>Monto</h2></td>
        </tr>
      </table>
      <div align="center">--------------------------------------------------------</div>
      <table id="productTable">
        <!-- Product rows will be inserted here -->
      </table>
      <div align="center">--------------------------------------------------------</div>
      <table>
        <tr>
          <td class="detail">Subtotal</td>
          <td class="detail1">L<span id="subtotal"></span></td>
        </tr>
        <tr>
          <td class="detail">Descuento</td>
          <td class="detail1">L<span id="descuento"></span></td>
        </tr>        
        <tr>
          <td class="detail">Total venta:</td>
          <td class="detail1">L<span id="total"></span></td>
        </tr>
        <tr>
          <td class="detail">Recibido:</td>
          <td class="detail1">L<span id="recibido"></span></td>
        </tr>
        <tr>
          <td class="detail">Cambio:</td>
          <td class="detail1">L<span id="cambio"></span></td>
        </tr>
      </table>
      <div align="center">--------------------------------------------------------</div>
      <div id="montoLetras" style="text-align: center"></div>
      <div align="center">--------------------------------------------------------</div>
      <div align="center">Gracias por su preferencia!!</div>
      <div align="center">Original: Cliente, Copia: Emisor</div>
      <div align="center">--------------------------------------------------------</div>
      <div style="text-align: center">
        <img alt="Barcode Generator TEC-IT" id="barcode" />
      </div>
      <div align="center">--------------------------------------------------------</div>
      <div
        style="
          padding-top: 8px;
          text-align: center;
          font-size: 15px;
          font-family: Source Sans Pro, Arial, sans-serif;
        "
      >
        <span>www.rmposhn.com</span><br />
        <span>indime.hn@gmail.com</span><br />
        <span>(+504) 9359-3126</span>
      </div>
    </div>
    <script>
      // Function to get URL parameters
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        var results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }
      // Function to set text content of an element
      function setTextContent(id, value) {
        document.getElementById(id).textContent = value;
      }
      // Populate the receipt with data from URL parameters
      setTextContent("empresa", getUrlParameter("empresa"));
      setTextContent("razon", getUrlParameter("razon"));
      setTextContent("rtn", getUrlParameter("rtn"));
      setTextContent("direccion", getUrlParameter("direccion"));
      setTextContent("telefono", getUrlParameter("telefono"));
      setTextContent("email", getUrlParameter("email"));
      setTextContent("tipodoc", getUrlParameter("tipodoc"));
      setTextContent("factura", getUrlParameter("factura"));
      setTextContent("date", getUrlParameter("date"));      
      setTextContent("cliente", getUrlParameter("cliente"));
      setTextContent("rtncliente", getUrlParameter("rtncliente"));
      setTextContent("direccioncliente", getUrlParameter("direccioncliente"));
      setTextContent("telefonocliente", getUrlParameter("telefonocliente"));
      setTextContent("formapago", getUrlParameter("formapago"));
      setTextContent("plazo", getUrlParameter("plazo"));
      setTextContent("pagos", getUrlParameter("pagos"));
      setTextContent("cuota", getUrlParameter("cuota"));      
      setTextContent("subtotal", getUrlParameter("subtotal"));
      setTextContent("descuento", getUrlParameter("descuento"));      
      setTextContent("total", getUrlParameter("total"));
      setTextContent("recibido", getUrlParameter("recibido"));
      setTextContent("cambio", getUrlParameter("cambio"));
      // Helper to safely parse number or fallback to empty string
      function safeNum(val) {
        if (val === null || val === undefined || val === "") return "";
        var num = parseFloat(val.replace(",", "."));
        return isNaN(num) ? val : num.toFixed(2);
      }
      // Populate product table (fix for decimals and undefined)
      var descriptions = getUrlParameter("descriptions");
      descriptions = descriptions ? descriptions.split(",") : [];
      var quantitys = getUrlParameter("quantitys");
      quantitys = quantitys ? quantitys.split(",") : [];
      var prices = getUrlParameter("price");
      prices = prices ? prices.split(",") : [];
      var descproductos = getUrlParameter("descproducto");
      descproductos = descproductos ? descproductos.split(",") : [];
      var isvproductos = getUrlParameter("isvproducto");
      isvproductos = isvproductos ? isvproductos.split(",") : [];
      var amounts = getUrlParameter("amounts");
      amounts = amounts ? amounts.split(",") : [];
      var productTable = document.getElementById("productTable");
      var len = Math.max(
        descriptions.length,
        quantitys.length,
        prices.length,
        descproductos.length,
        isvproductos.length,
        amounts.length
      );
      for (var i = 0; i < len; i++) {
        var descriptionText = descriptions[i] !== undefined ? descriptions[i] : "";
        var descriptionRow = productTable.insertRow();
        descriptionRow.innerHTML = `
        <td colspan="5" class="descriptions">${descriptionText}</td>
    `;
        var qtyText = quantitys[i] !== undefined ? safeNum(quantitys[i]) : "";
        var priceText = prices[i] !== undefined ? safeNum(prices[i]) : "";
        var descText = descproductos[i] !== undefined ? safeNum(descproductos[i]) : "";
        var isvText = isvproductos[i] !== undefined ? safeNum(isvproductos[i]) : "";
        var amountText = amounts[i] !== undefined ? safeNum(amounts[i]) : "";
        var detailsRow = productTable.insertRow();
        detailsRow.innerHTML = `
        <td class="qty">${qtyText}</td>
        <td class="Price">${priceText}</td>
        <td class="Desc">${descText}</td>
        <td class="Isv">${isvText}</td>
        <td class="Amount">${amountText}</td>
    `;
        detailsRow.className = "listitem";
      }
      document.getElementById("barcode").src =
        "https://barcode.tec-it.com/barcode.ashx?data=" +
        getUrlParameter("Folio_1");
      // Function to convert number to words (Spanish, with decimals)
      function numeroALetras(numero) {
        numero = typeof numero === "string" ? numero.replace(",", ".") : numero;
        var partes = numero.toString().split(".");
        var entero = parseInt(partes[0], 10);
        var decimales = partes[1] ? parseInt((partes[1]+'00').substring(0,2), 10) : 0;
        const unidades = [
          "",
          "UN",
          "DOS",
          "TRES",
          "CUATRO",
          "CINCO",
          "SEIS",
          "SIETE",
          "OCHO",
          "NUEVE",
          "DIEZ",
          "ONCE",
          "DOCE",
          "TRECE",
          "CATORCE",
          "QUINCE",
          "DIECISEIS",
          "DIECISIETE",
          "DIECIOCHO",
          "DIECINUEVE",
        ];
        const decenas = [
          "",
          "",
          "VEINTE",
          "TREINTA",
          "CUARENTA",
          "CINCUENTA",
          "SESENTA",
          "SETENTA",
          "OCHENTA",
          "NOVENTA",
        ];
        const centenas = [
          "",
          "CIENTO",
          "DOSCIENTOS",
          "TRESCIENTOS",
          "CUATROCIENTOS",
          "QUINIENTOS",
          "SEISCIENTOS",
          "SETECIENTOS",
          "OCHOCIENTOS",
          "NOVECIENTOS",
        ];
        function convertirGrupo(n) {
          let resultado = "";
          if (n === 100) {
            return "CIEN";
          }
          if (n >= 100) {
            resultado += centenas[Math.floor(n / 100)] + " ";
            n %= 100;
          }
          if (n >= 20) {
            resultado += decenas[Math.floor(n / 10)];
            if (n % 10 !== 0) {
              resultado += " Y " + unidades[n % 10];
            }
          } else if (n > 0) {
            resultado += unidades[n];
          }
          return resultado.trim();
        }
        function convertirMiles(n) {
          if (n === 0) return "";
          if (n === 1) return "MIL";
          return convertirGrupo(n) + " MIL";
        }
        function convertirMillones(n) {
          if (n === 0) return "";
          if (n === 1) return "UN MILLON";
          return convertirGrupo(n) + " MILLONES";
        }
        if (entero === 0) return "CERO LEMPIRAS";
        let resultado = "";
        let esNegativo = numero < 0;
        entero = Math.abs(entero);
        let millones = Math.floor(entero / 1000000);
        let miles = Math.floor((entero % 1000000) / 1000);
        let resto = entero % 1000;
        if (millones > 0) {
          resultado += convertirMillones(millones) + " ";
        }
        if (miles > 0) {
          resultado += convertirMiles(miles) + " ";
        }
        if (resto > 0 || resultado === "") {
          resultado += convertirGrupo(resto);
        }
        resultado = resultado.trim();
        if (esNegativo) {
          resultado = "MENOS " + resultado;
        }
        resultado += entero === 1 ? " LEMPIRA" : " LEMPIRAS";
        if (decimales > 0) {
          resultado += " CON " + decimales + (decimales === 1 ? " CENTAVO" : " CENTAVOS");
        }
        return resultado;
      }
      // Set monto en letras (fix for decimals)
      var totalParam = getUrlParameter("total");
      var total = totalParam ? totalParam.replace(",", ".") : "0";
      document.getElementById("montoLetras").textContent =
        "SON " + numeroALetras(total);
      // Trigger print when the page loads
      window.onload = function () {
        window.print();
      };
    </script>
  </body>
</html>
